{% extends "templates/default.html" %}
{% block content %}

<div id="a">
  <div id="ai" class="bar"><span class="clickable">Search</span></div>
  <div id="searchForm" class="bucket">
    <form>
      <label for="minPrice">minimum price ('000)</label>
        <input id="minPrice" type="text" />
      <label for="maxPrice">maximum price ('000)</label>
        <input id="maxPrice" type="text" />
      <input type="submit" id="search" value="Search" />
    </form>
  </div>
</div>
<div id="b">
  <div id="bi" class="bar"><span class="clickable">Results</span></div>
  <div id="bii" class="bucket">Results will appear here</div>
</div>
<div>
  <div id='mapi' class="bar"><span class="clickable">Map</span></div>
  <div id="map_canvas" class="bucket" style="width: 100%; height: 400px"></div>
  
<script type="text/javascript">
$(document).ready(
function(){
  initialize();//gmaps initialize
  $('.bucket').hide();
  $('#map_canvas').show();
  $('.bar').click(function(){
    $(this).next('.bucket').toggle('slow');
  });
  $('#searchForm').show();

  var geocoder = new GClientGeocoder();
  function showAddress(addr){
    function callback(point){
      if (!point){
        alert('sorry, not found');
      } else {
        alert('found ' + addr);
        map.setCenter(point, 13);
      }
    }
    geocoder.getLatLng(addr, callback);
  }
  
  function successFunc(data){
    data = JSON.parse(data)
    if (data.length>0)
    {
      showAddress(data[0] + ', NSW');
    }
    alert(data);
  }
  function ajaxSubmit(){
    var data = {};
    var url = '/ajaxSearch';
    var minPrice = $('#minPrice').val();
    var maxPrice = $('#maxPrice').val();
    data['minPrice']= minPrice;
    data['maxPrice']= maxPrice;
    $.get(url, JSON.stringify(data), successFunc);
  }
  function validate(){
    return true; //TODO
  }
  $('#searchForm').submit(function(){
    if (validate()) {
      ajaxSubmit();
    } else {

    }
    return false;
  });
});
$(window).unload(
function(){
  GUnload();
});

</script>
{% endblock %}
